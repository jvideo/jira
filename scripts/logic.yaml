type: update
name: Jira Logic
id: jira-software-logic
   
onAfterBindSSL: 
  - cmd[bl]: source /opt/letsencrypt/settings && echo $domain
  - set:
      domain: ${response.out}
  - env.control.AddContainerEnvVars[cp]:
       vars: 
         ATL_PROXY_NAME: ${this.domain}

onAfterStart:
  restartContainers:
      nodeGroup: cp

onAfterSetCloudletCount[cp]:
   - cmd[cp]: free -m | sed -n '2p' | awk '{printf "%.f", $2 * 0.7}'
   - env.control.AddContainerEnvVars[cp]:
       vars:
         JVM_MAXIMUM_MEMORY: ${response.out}m
   - restartContainers:
       nodeGroup: cp

onInstall:
  - cmd[cp]: free -m | sed -n '2p' | awk '{printf "%.f", $2 * 0.7}'
  - env.control.AddContainerEnvVars[cp]:
      vars:
        ATL_PROXY_NAME: ${env.domain}
        JVM_MAXIMUM_MEMORY: ${response.out}m
  - env.control.ExecDockerRunCmd[${nodes.cp.join(id,)}]

