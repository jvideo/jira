type: install
version: 1.5
name: Jira Install
description: Jira Ticketing System
      
nodes:
- count: 1
  cloudlets: 10
  nodeType: centos7
  nodeGroup: vds
  extip: false

onInstall:
  - downloadJira
  - setupJira
#  - portRedirect
    
actions:
  downloadJira:
    cmd [centos7]: |-
      wget -qO /root/jira.bin https://product-downloads.atlassian.com/software/jira/downloads/atlassian-jira-core-8.10.0-x64.bin
      chmod a+x /root/jira.bin
  setupJira:
    cmd [centos7]: |-
      expect -c '
      spawn /root/jira.bin
      expect "For more info, see https://confluence.atlassian.com/x/PRCEOQ"
      send "y\r"
      expect "OK \[o, Enter\], Cancel \[c\]"
      send "\r"
      expect "Express Install (use default settings) \[1\], Custom Install (recommended for advanced users) \[2, Enter\], Upgrade an existing Jira installation \[3\]" 
      send "1\r"
      expect "Install \[i, Enter\], Exit \[e\]"
      send "\r"
      expect "Yes \[y, Enter\], No \[n\]"
      send "\r"
      expect eof
      '
  portRedirect:
    cmd [centos7]: |-
      iptables -A PREROUTING -t nat -p tcp --dport 80 -j REDIRECT --to-ports 8080
      service iptables save

startPage: http://${env.domain}:8080

success: |
     ### Jira is installed 
